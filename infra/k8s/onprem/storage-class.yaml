# Storage Class for On-Premise Kubernetes Deployment
# This file provides multiple storage options for different on-premise setups

---
# Option 1: Local Path Provisioner (Rancher local-path-provisioner)
# Best for: Development, single-node clusters, or when using local storage
# Install: kubectl apply -f https://raw.githubusercontent.com/rancher/local-path-provisioner/v0.0.24/deploy/local-path-storage.yaml

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-path
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: rancher.io/local-path
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Delete

---
# Option 2: NFS Storage Class
# Best for: Multi-node clusters with shared NFS storage
# Requires: NFS CSI driver or NFS Subdir External Provisioner
# Install NFS Subdir: helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/
#                    helm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \
#                      --set nfs.server=<NFS_SERVER_IP> \
#                      --set nfs.path=<NFS_PATH>

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: nfs-client
provisioner: k8s-sigs.io/nfs-subdir-external-provisioner
parameters:
  archiveOnDelete: "true"
reclaimPolicy: Retain
volumeBindingMode: Immediate

---
# Option 3: OpenEBS LocalPV
# Best for: Production on-premise with local disks and replication
# Install: kubectl apply -f https://openebs.github.io/charts/openebs-operator.yaml

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: openebs-hostpath
provisioner: openebs.io/local
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Delete
parameters:
  StorageType: "hostpath"
  BasePath: "/var/openebs/local"

---
# Option 4: Longhorn (Distributed block storage)
# Best for: Production with data replication and backup
# Install: kubectl apply -f https://raw.githubusercontent.com/longhorn/longhorn/v1.5.3/deploy/longhorn.yaml

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: longhorn
provisioner: driver.longhorn.io
allowVolumeExpansion: true
reclaimPolicy: Delete
volumeBindingMode: Immediate
parameters:
  numberOfReplicas: "3"
  staleReplicaTimeout: "2880"  # 48 hours in minutes
  fromBackup: ""

---
# Option 5: Ceph/Rook (Enterprise-grade distributed storage)
# Best for: Large-scale production with high availability
# Install: kubectl apply -f https://raw.githubusercontent.com/rook/rook/master/deploy/examples/crds.yaml
#          kubectl apply -f https://raw.githubusercontent.com/rook/rook/master/deploy/examples/operator.yaml

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: rook-ceph-block
provisioner: rook-ceph.rbd.csi.ceph.com
parameters:
  clusterID: rook-ceph
  pool: replicapool
  imageFormat: "2"
  imageFeatures: layering
  csi.storage.k8s.io/provisioner-secret-name: rook-csi-rbd-provisioner
  csi.storage.k8s.io/provisioner-secret-namespace: rook-ceph
  csi.storage.k8s.io/controller-expand-secret-name: rook-csi-rbd-provisioner
  csi.storage.k8s.io/controller-expand-secret-namespace: rook-ceph
  csi.storage.k8s.io/node-stage-secret-name: rook-csi-rbd-node
  csi.storage.k8s.io/node-stage-secret-namespace: rook-ceph
  csi.storage.k8s.io/fstype: ext4
allowVolumeExpansion: true
reclaimPolicy: Delete
volumeBindingMode: Immediate

---
# Option 6: HostPath (Simple, for development only)
# WARNING: Not recommended for production - no data persistence across node failures

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: hostpath
provisioner: kubernetes.io/no-provisioner
volumeBindingMode: WaitForFirstConsumer

---
# PersistentVolume example for HostPath (manual provisioning)
apiVersion: v1
kind: PersistentVolume
metadata:
  name: postgres-pv
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: hostpath
  hostPath:
    path: /mnt/data/postgres
    type: DirectoryOrCreate
  nodeAffinity:
    required:
      nodeSelectorTerms:
      - matchExpressions:
        - key: kubernetes.io/hostname
          operator: In
          values:
          - node1  # Replace with your node name

---
# Storage Class Selection Guide:
#
# Development/Testing:
#   - local-path: Simple, single-node, fast
#   - hostpath: Manual PV creation required
#
# Small Production (1-3 nodes):
#   - NFS: If you have existing NFS server
#   - OpenEBS LocalPV: Simple, no external dependencies
#
# Medium Production (3-10 nodes):
#   - Longhorn: Good balance of features and complexity
#   - OpenEBS with replication
#
# Large Production (10+ nodes):
#   - Rook/Ceph: Enterprise features, high availability
#   - Longhorn with backup to S3-compatible storage
#
# To set a storage class as default:
# kubectl patch storageclass <NAME> -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'
